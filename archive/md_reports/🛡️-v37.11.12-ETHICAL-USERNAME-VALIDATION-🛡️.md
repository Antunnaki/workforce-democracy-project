# ğŸ›¡ï¸ v37.11.12 - ETHICAL USERNAME VALIDATION ğŸ›¡ï¸

**ğŸ“… Date**: January 20, 2025  
**ğŸ¯ Purpose**: Implement comprehensive username validation to protect platform integrity  
**âš ï¸ Priority**: HIGH - Protects community safety and inclusivity  
**ğŸ“¦ Version**: v37.11.12

---

## ğŸ¯ WHAT THIS UPDATE DOES

Implements a comprehensive ethical username validation system that prevents:

1. **Profanity and Obscenities** - Blocks common offensive language
2. **Hate Speech and Slurs** - Prevents racist, homophobic, and discriminatory terms
3. **Bullying and Harassment** - Filters aggressive and harmful language
4. **Culturally Insensitive Terms** - Protects against offensive cultural references
5. **Impersonation Attempts** - Blocks attempts to impersonate staff, officials, or brands
6. **Leet Speak Obfuscation** - Detects attempts to bypass filters using number/symbol substitution

---

## ğŸ“‚ FILES CREATED/MODIFIED

### **NEW FILES:**
1. **`backend/utils/username-validator.js`** (5,894 bytes)
   - Comprehensive validation logic
   - Categorized blocklists
   - Leet speak detection
   - Pattern matching for common violations

### **MODIFIED FILES:**
2. **`backend/routes/personalization.js`** (Updated to v1.2.0)
   - Integrated username validation on registration
   - Sanitizes usernames (trims whitespace)
   - Logs rejected usernames for monitoring

### **DEPLOYMENT FILES:**
3. **`backend/DEPLOY-v37.11.12-USERNAME-VALIDATION.sh`**
   - Automated deployment script
   - Includes MongoDB test account wipe
   - Verification tests included

4. **`ğŸ›¡ï¸-v37.11.12-ETHICAL-USERNAME-VALIDATION-ğŸ›¡ï¸.md`** (this file)
   - Complete documentation
   - Deployment guide
   - Testing instructions

---

## ğŸ›¡ï¸ VALIDATION RULES

### **Character Requirements:**
- âœ… **Minimum length**: 3 characters
- âœ… **Maximum length**: 50 characters
- âœ… **Allowed characters**: Letters (a-z, A-Z), numbers (0-9), underscore (_), hyphen (-)
- âœ… **Must start with**: A letter (a-z, A-Z)
- âŒ **No special characters**: @, #, $, %, &, etc.
- âŒ **No spaces**: Usernames must be continuous

### **Content Restrictions:**

#### **1. Profanity Filter**
Blocks common offensive language:
- Basic profanity (shit, fuck, bitch, etc.)
- Sexual terms
- Crude language

#### **2. Hate Speech Filter**
Prevents racist, homophobic, and discriminatory slurs:
- Racial slurs (all variants)
- Homophobic terms
- Religious slurs
- Ethnic slurs

#### **3. Bullying Prevention**
Blocks aggressive and harmful terms:
- Insults (loser, stupid, idiot, moron)
- Self-harm references (suicide, kill, die)
- Sexual violence terms (rape, molest)
- Predatory terms (pedo, pedophile)

#### **4. Cultural Sensitivity**
Prevents offensive cultural/historical references:
- Extremist terminology (jihad, isis, taliban)
- Historical atrocities (holocaust, genocide, apartheid)
- Slavery references (slave, master, plantation)

#### **5. Impersonation Protection**
Blocks attempts to impersonate:
- **Platform staff**: admin, moderator, staff, official, support, system
- **Government**: president, senator, congress, fbi, cia, police
- **Major brands**: google, facebook, twitter, microsoft, apple

#### **6. Pattern Restrictions**
Rejects suspicious patterns:
- **All numbers**: `12345`, `999999`
- **Excessive repetition**: `aaaaa`, `11111`
- **Test accounts**: `test`, `test1`, `test123`
- **Admin variations**: `admin`, `admin1`, `administrator`

### **Obfuscation Detection:**

The system detects "leet speak" attempts to bypass filters:

| Leet Speak | Normal | Example Blocked |
|------------|--------|-----------------|
| `4dm1n`    | admin  | âŒ Blocked      |
| `m0d3r4t0r`| moderator | âŒ Blocked   |
| `t3st`     | test   | âŒ Blocked      |
| `@dm!n`    | admin  | âŒ Blocked      |

---

## ğŸ“Š VALIDATION EXAMPLES

### **âœ… VALID USERNAMES:**
```
âœ… AprilJr                  (clean, descriptive)
âœ… CitizenAdvocate         (meaningful, appropriate)
âœ… DemocracyNow            (civic-minded)
âœ… WorkerRights2025        (topical, dated)
âœ… Policy_Analyst          (professional, underscore allowed)
âœ… Community-Helper        (helpful, hyphen allowed)
```

### **âŒ INVALID USERNAMES:**

```
âŒ admin                   â†’ "Username format is not allowed"
âŒ test123                 â†’ "Username format is not allowed"
âŒ moderator1              â†’ "Username contains inappropriate language"
âŒ F_ckPolitics            â†’ "Username contains inappropriate language"
âŒ 12345                   â†’ "Username format is not allowed"
âŒ aaaaaaaa                â†’ "Username format is not allowed"
âŒ @dminist4tor            â†’ "Username can only contain letters, numbers..."
âŒ President_Biden         â†’ "Username contains inappropriate language" (impersonation)
```

---

## ğŸš€ DEPLOYMENT GUIDE

### **STEP 1: Prepare Files**

Navigate to your backend directory:
```bash
cd "/Users/acejrowski/Desktop/AG/WORKFORCE DEMOCRACY PROJECT/SITE FILES/WDP-v37.11.11/backend/"
```

### **STEP 2: Make Deployment Script Executable**

```bash
chmod +x DEPLOY-v37.11.12-USERNAME-VALIDATION.sh
```

### **STEP 3: Run Deployment Script**

```bash
./DEPLOY-v37.11.12-USERNAME-VALIDATION.sh
```

**The script will:**
1. âœ… Connect to MongoDB and wipe all test accounts
2. âœ… Upload `username-validator.js` to VPS
3. âœ… Upload updated `personalization.js` to VPS
4. âœ… Restart PM2 backend
5. âœ… Run verification tests

---

## ğŸ—‘ï¸ MANUAL DATABASE WIPE (Alternative Method)

If you prefer to manually wipe test accounts:

```bash
# SSH into VPS
ssh root@185.193.126.13

# Connect to MongoDB
mongosh workforce_democracy

# View current accounts
db.sessions.find().pretty()
db.userbackups.find().pretty()

# Delete all test accounts
db.sessions.deleteMany({})
db.userbackups.deleteMany({})

# Verify deletion
db.sessions.countDocuments()    // Should return: 0
db.userbackups.countDocuments() // Should return: 0

# Exit
exit
exit
```

---

## ğŸ§ª TESTING THE VALIDATION

### **Test 1: Valid Username**

```bash
curl -X POST https://api.workforcedemocracyproject.org/api/personalization/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "MyRealAccount",
    "encrypted_data": "test_encrypted",
    "iv": "test_iv",
    "encryption_salt": "test_salt",
    "recovery_hash": "test_recovery"
  }'
```

**Expected**: `201 Created` - Account created successfully

---

### **Test 2: Profanity (Should Fail)**

```bash
curl -X POST https://api.workforcedemocracyproject.org/api/personalization/register \
  -H "Content-Type: application/json" \
  -d '{"username": "BadWordHere"}'
```

**Expected**: `400 Bad Request` - "Username contains inappropriate language"

---

### **Test 3: Impersonation (Should Fail)**

```bash
curl -X POST https://api.workforcedemocracyproject.org/api/personalization/register \
  -H "Content-Type: application/json" \
  -d '{"username": "admin123"}'
```

**Expected**: `400 Bad Request` - "Username format is not allowed"

---

### **Test 4: Test Account (Should Fail)**

```bash
curl -X POST https://api.workforcedemocracyproject.org/api/personalization/register \
  -H "Content-Type: application/json" \
  -d '{"username": "tester999"}'
```

**Expected**: `400 Bad Request` - "Username format is not allowed"

---

## ğŸ” MONITORING REJECTED USERNAMES

Backend logs will show rejected usernames:

```bash
# View PM2 logs
/opt/nodejs/bin/pm2 logs backend --lines 50

# Look for lines like:
# âŒ Username rejected: "admin123" - Reason: Username format is not allowed
# âŒ Username rejected: "test999" - Reason: Username format is not allowed
```

This helps you monitor:
- Common inappropriate username attempts
- Patterns of abuse
- Filter effectiveness

---

## ğŸ“ ERROR MESSAGES

Users will receive **user-friendly, non-specific error messages** to prevent:
- Gaming the filter system
- Learning what specific words are blocked
- Finding workarounds

### **Generic Error Messages:**
1. `"Username contains inappropriate language"` - Broad category (profanity, hate speech, bullying)
2. `"Username format is not allowed"` - Pattern-based rejection (test accounts, admin, repetition)
3. `"Username can only contain letters, numbers, underscores, and hyphens"` - Character validation
4. `"Username must start with a letter"` - Format rule
5. `"Username must be at least 3 characters"` - Length validation
6. `"Username must be 50 characters or less"` - Length validation

---

## ğŸ”§ MAINTENANCE & UPDATES

### **Adding New Blocked Terms:**

Edit `backend/utils/username-validator.js`:

```javascript
const BLOCKLIST = {
  profanity: [
    'existing_term',
    'new_term_to_add'  // â† Add here
  ],
  // ... other categories
}
```

After editing, redeploy:
```bash
scp utils/username-validator.js root@185.193.126.13:/var/www/workforce-democracy/backend/utils/
ssh root@185.193.126.13 "/opt/nodejs/bin/pm2 restart backend"
```

---

## ğŸ¯ INTEGRATION POINTS

This validation system is integrated at:

1. **Registration endpoint**: `/api/personalization/register`
2. **Before database check**: Validation happens BEFORE checking if username exists
3. **Before session creation**: Only valid usernames get sessions
4. **Server-side only**: Frontend validation is optional (server is authoritative)

---

## âœ… DEPLOYMENT CHECKLIST

Before deploying to production:

- [ ] **Test accounts wiped** from MongoDB (sessions + userbackups)
- [ ] **Username validator uploaded** to VPS (`utils/username-validator.js`)
- [ ] **Personalization routes updated** on VPS (`routes/personalization.js`)
- [ ] **PM2 backend restarted** successfully
- [ ] **Backend logs show** no errors
- [ ] **Validation tested** with curl commands (valid + invalid usernames)
- [ ] **Frontend deployed** to Netlify (if needed)
- [ ] **Real account created** successfully
- [ ] **Documentation reviewed** and understood

---

## ğŸ‰ BENEFITS OF THIS UPDATE

1. **ğŸ›¡ï¸ Protects Community Safety** - Prevents harmful, offensive usernames
2. **ğŸŒ Promotes Inclusivity** - Blocks culturally insensitive and discriminatory language
3. **ğŸ”’ Prevents Impersonation** - Users can't pretend to be staff or officials
4. **ğŸ“ˆ Builds Trust** - Shows commitment to ethical platform management
5. **âš–ï¸ Legal Protection** - Demonstrates proactive moderation efforts
6. **ğŸ§¹ Clean User Base** - Eliminates test accounts and inappropriate names
7. **ğŸ” Monitoring Capability** - Logs help identify abuse patterns

---

## ğŸ“ SUPPORT & TROUBLESHOOTING

### **Issue: Legitimate username rejected**

**Solution**: Review `backend/utils/username-validator.js` blocklist and remove false positives.

Example: If "Essex" is rejected because it contains "sex", add an exception:
```javascript
// Add to validation logic:
const ALLOWED_EXCEPTIONS = ['essex', 'sussex', 'middlesex'];
```

---

### **Issue: Validation not working**

**Check:**
1. PM2 backend restarted? `/opt/nodejs/bin/pm2 restart backend`
2. Files uploaded correctly? `ls -la /var/www/workforce-democracy/backend/utils/`
3. Backend logs show errors? `/opt/nodejs/bin/pm2 logs backend --lines 50`

---

## ğŸš€ NEXT STEPS AFTER DEPLOYMENT

1. **Wipe test accounts** âœ… (via deployment script)
2. **Deploy backend** âœ… (via deployment script)
3. **Deploy frontend to Netlify** (WDP-v37.11.11 folder)
4. **Create your real account** on https://workforcedemocracyproject.org/
5. **Test username validation** with various inputs
6. **Monitor backend logs** for rejected username attempts
7. **Enjoy a clean, ethical user base!** ğŸ‰

---

**ğŸ“Œ Version**: v37.11.12  
**ğŸ“… Deployed**: January 20, 2025  
**ğŸ‘¤ Requested By**: User  
**ğŸ¯ Purpose**: Fresh start with ethical username standards  
**âœ… Status**: READY FOR DEPLOYMENT

---

## ğŸ“š RELATED DOCUMENTATION

- `ğŸ¯-YOUR-PERSONALIZED-v37.11.x-DEPLOYMENT-GUIDE-ğŸ¯.md` - Main deployment guide
- `ğŸ”’-CRITICAL-DEPLOYMENT-ARCHITECTURE-ğŸ”’.md` - Deployment architecture
- `backend/DEPLOY-v37.11.12-USERNAME-VALIDATION.sh` - Deployment script

---

**Thank you for prioritizing ethical platform management!** ğŸ™
